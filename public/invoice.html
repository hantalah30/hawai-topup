<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Invoice Premium - Hawai Omega</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      /* --- STYLE DASAR (Sama seperti sebelumnya) --- */
      :root {
        --primary: #00f3ff;
        --secondary: #bc13fe;
        --bg-dark: #050507;
        --panel-bg: #0e0e12;
        --border: rgba(255, 255, 255, 0.08);
        --font-mono: "Consolas", "Monaco", monospace;
      }

      body {
        background-color: #000;
        color: #fff;
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        height: 100vh;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* --- LAYOUT UTAMA --- */
      .invoice-layout {
        display: flex;
        width: 100%;
        height: 100%;
        max-width: 1300px;
        max-height: 850px;
        background: var(--bg-dark);
        border-radius: 25px;
        overflow: hidden;
        box-shadow: 0 0 80px rgba(0, 243, 255, 0.05);
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.05);
        opacity: 0;
        animation: fadeIn 1s forwards;
      }
      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      /* --- SISI KIRI (VISUAL) --- */
      .visual-side {
        flex: 4;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 1;
        background: #000;
      }
      .visual-bg {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        opacity: 0.6;
        transition: transform 0.2s;
        z-index: -2;
      }
      .crt-overlay {
        position: absolute;
        inset: 0;
        background:
          linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
          linear-gradient(
            90deg,
            rgba(255, 0, 0, 0.06),
            rgba(0, 255, 0, 0.02),
            rgba(0, 0, 255, 0.06)
          );
        background-size:
          100% 2px,
          3px 100%;
        pointer-events: none;
        z-index: 0;
      }
      #particles {
        position: absolute;
        inset: 0;
        z-index: -1;
      }

      /* Logo 3D */
      .logo-container {
        perspective: 1000px;
        margin-bottom: 20px;
        position: relative;
      }
      .game-logo-large {
        width: 130px;
        height: 130px;
        border-radius: 30px;
        box-shadow: 0 0 50px rgba(0, 243, 255, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        background: #000;
        z-index: 2;
        position: relative;
      }
      .logo-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 140px;
        height: 140px;
        border-radius: 50%;
        background: var(--primary);
        filter: blur(60px);
        opacity: 0.4;
        z-index: 1;
        animation: pulseGlow 3s infinite;
      }
      @keyframes pulseGlow {
        0%,
        100% {
          opacity: 0.4;
          transform: translate(-50%, -50%) scale(1);
        }
        50% {
          opacity: 0.6;
          transform: translate(-50%, -50%) scale(1.1);
        }
      }

      .game-title-large {
        font-size: 3.5rem;
        font-weight: 900;
        line-height: 1;
        text-transform: uppercase;
        color: #fff;
        position: relative;
        text-shadow:
          2px 2px var(--secondary),
          -2px -2px var(--primary);
        animation: glitch 3s infinite alternate;
      }
      @keyframes glitch {
        0% {
          text-shadow:
            2px 2px var(--secondary),
            -2px -2px var(--primary);
        }
        100% {
          text-shadow:
            2px 2px var(--secondary),
            -2px -2px var(--primary);
        }
      }

      /* --- SISI KANAN (DETAIL) --- */
      .detail-side {
        flex: 6;
        background: var(--panel-bg);
        padding: 40px 50px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        border-left: 1px solid var(--border);
        position: relative;
      }

      /* Timeline */
      .stepper-wrapper {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        position: relative;
      }
      .progress-line {
        position: absolute;
        top: 15px;
        left: 0;
        width: 100%;
        height: 2px;
        background: #222;
        z-index: 0;
      }
      .progress-fill {
        position: absolute;
        top: 15px;
        left: 0;
        height: 2px;
        background: var(--primary);
        z-index: 0;
        width: 0%;
        transition: width 1s ease;
        box-shadow: 0 0 10px var(--primary);
      }
      .stepper-item {
        position: relative;
        z-index: 1;
        text-align: center;
        width: 33%;
        opacity: 0.5;
        transition: 0.3s;
      }
      .stepper-item.active {
        opacity: 1;
      }
      .step-counter {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #111;
        color: #fff;
        border: 2px solid #333;
        margin: 0 auto 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        transition: 0.3s;
      }
      .stepper-item.active .step-counter {
        border-color: var(--primary);
        box-shadow: 0 0 15px var(--primary);
        color: var(--primary);
      }
      .stepper-item.completed .step-counter {
        background: var(--primary);
        border-color: var(--primary);
        color: #000;
      }

      /* --- UPGRADE: NICKNAME BADGE --- */
      .nick-wrapper {
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid rgba(0, 255, 136, 0.3);
        border-radius: 50px;
        padding: 5px 15px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 5px;
        box-shadow: 0 0 15px rgba(0, 255, 136, 0.1);
        position: relative;
        overflow: hidden;
      }
      /* Kilau Berjalan */
      .nick-wrapper::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        animation: shine 3s infinite;
      }
      @keyframes shine {
        0% {
          left: -100%;
        }
        20% {
          left: 100%;
        }
        100% {
          left: 100%;
        }
      }

      .nick-text {
        color: #00ff88;
        font-family: var(--font-mono);
        font-weight: bold;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
      }

      .verified-icon {
        color: #00ff88;
        animation: pulse-verify 2s infinite;
      }
      @keyframes pulse-verify {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
          text-shadow: 0 0 10px #00ff88;
        }
        100% {
          transform: scale(1);
        }
      }

      /* Detail Box */
      .info-card {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
      }
      .row-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 0.95rem;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
        padding-bottom: 8px;
      }
      .row-item:last-child {
        border: 0;
        padding: 0;
        margin: 0;
      }
      .val-hl {
        color: var(--primary);
        font-family: var(--font-mono);
        letter-spacing: 1px;
      }

      /* Payment Zone */
      .payment-zone {
        background: #fff;
        color: #000;
        border-radius: 20px;
        padding: 25px;
        text-align: center;
        margin-top: auto;
        position: relative;
        overflow: hidden;
        box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);
      }

      /* QR & VA */
      .qr-wrapper {
        position: relative;
        display: inline-block;
        border: 10px solid #fff;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 10px;
      }
      .qr-laser {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: rgba(255, 0, 0, 0.5);
        box-shadow: 0 0 10px red;
        animation: scan 2s infinite ease-in-out;
      }
      @keyframes scan {
        0%,
        100% {
          top: 0;
        }
        50% {
          top: 100%;
        }
      }

      .va-display {
        font-family: var(--font-mono);
        font-size: 2.2rem;
        font-weight: 800;
        letter-spacing: 2px;
        color: #333;
        margin: 10px 0;
        cursor: pointer;
        position: relative;
        transition: 0.2s;
      }
      .va-display:active {
        transform: scale(0.95);
      }
      .copy-tooltip {
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: #000;
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8rem;
        opacity: 0;
        transition: 0.2s;
        pointer-events: none;
      }
      .va-display:hover .copy-tooltip {
        opacity: 1;
        top: -40px;
      }

      /* Success */
      .success-overlay {
        position: absolute;
        inset: 0;
        background: #000;
        z-index: 10;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation: expand 0.5s ease;
      }
      @keyframes expand {
        from {
          clip-path: circle(0% at 50% 50%);
        }
        to {
          clip-path: circle(150% at 50% 50%);
        }
      }

      #loader {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 99;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      @media (max-width: 768px) {
        body {
          display: block;
          overflow-y: auto;
          height: auto;
          background: #0e0e12;
        }
        .invoice-layout {
          flex-direction: column;
          border-radius: 0;
          height: auto;
          max-height: none;
          border: none;
        }
        .visual-side {
          height: 320px;
          padding: 20px;
          justify-content: flex-end;
          padding-bottom: 50px;
        }
        .game-logo-large {
          width: 90px;
          height: 90px;
          margin-bottom: 10px;
        }
        .game-title-large {
          font-size: 2.2rem;
        }
        .detail-side {
          margin-top: -30px;
          border-top-left-radius: 30px;
          border-top-right-radius: 30px;
          border-top: 2px solid var(--primary);
          padding: 30px 20px;
          min-height: 60vh;
          background: #0e0e12;
        }
        .va-display {
          font-size: 1.6rem;
        }
      }
    </style>
  </head>
  <body>
    <audio
      id="sfx-success"
      src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"
    ></audio>
    <audio
      id="sfx-click"
      src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"
    ></audio>

    <div id="loader">
      <div class="text-center">
        <div
          class="spinner-border text-info mb-3"
          style="width: 3rem; height: 3rem"
        ></div>
        <div class="small fw-bold text-secondary ls-2">SECURE CHECKOUT...</div>
      </div>
    </div>

    <div class="invoice-layout">
      <div class="visual-side" id="visualSide">
        <div class="visual-bg" id="bgImg"></div>
        <canvas id="particles"></canvas>
        <div class="crt-overlay"></div>

        <div class="logo-container" id="logoWrap">
          <div class="logo-glow"></div>
          <img src="" id="gameLogo" class="game-logo-large" />
        </div>

        <div id="gameTitle" class="game-title-large">GAME</div>
        <div
          class="badge bg-dark border border-secondary text-secondary font-monospace"
          id="refIdSmall"
        >
          TRX-...
        </div>
      </div>

      <div class="detail-side">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="m-0 fw-bold">
            <i class="fas fa-receipt text-primary me-2"></i>Invoice
          </h4>
          <div>
            <button
              onclick="window.print()"
              class="btn btn-dark btn-sm rounded-pill me-2"
            >
              <i class="fas fa-print"></i>
            </button>
            <a
              href="index.html"
              class="btn btn-outline-secondary btn-sm rounded-pill"
            >
              <i class="fas fa-times"></i> Tutup
            </a>
          </div>
        </div>

        <div class="stepper-wrapper">
          <div class="progress-line">
            <div class="progress-fill" id="progFill"></div>
          </div>
          <div class="stepper-item completed">
            <div class="step-counter"><i class="fas fa-check"></i></div>
            Order
          </div>
          <div class="stepper-item active" id="stepPay">
            <div class="step-counter">2</div>
            Bayar
          </div>
          <div class="stepper-item" id="stepDone">
            <div class="step-counter">3</div>
            Selesai
          </div>
        </div>

        <div id="timerWrap" class="text-center mb-3">
          <div
            class="d-inline-block px-3 py-1 rounded bg-danger bg-opacity-10 text-danger fw-bold border border-danger border-opacity-25"
          >
            <i class="fas fa-stopwatch me-1"></i>
            <span id="countdown">--:--:--</span>
          </div>
        </div>

        <div class="info-card">
          <div class="row-item">
            <span class="lbl">Item</span>
            <span class="val text-white" id="dItem">...</span>
          </div>
          <div class="row-item">
            <span class="lbl">ID Player</span>
            <span class="val text-end"
              ><span id="dUid" class="val-hl">...</span></span
            >
          </div>

          <div class="row-item">
            <span class="lbl">Nickname</span>
            <span class="val text-end">
              <div class="nick-wrapper">
                <i class="fas fa-check-circle verified-icon"></i>
                <span id="dNick" class="nick-text">Checking...</span>
              </div>
            </span>
          </div>

          <div class="row-item">
            <span class="lbl">Metode</span>
            <span class="val text-info" id="dMethod">...</span>
          </div>
          <div
            class="row-item pt-2 mt-2"
            style="border-top: 1px dashed #444 !important"
          >
            <span class="lbl">Total Bayar</span>
            <span class="val fs-3 text-warning" id="dTotal">Rp 0</span>
          </div>
        </div>

        <div id="paymentArea" class="payment-zone"></div>

        <div id="successOverlay" class="success-overlay text-center">
          <i
            class="fas fa-check-circle fa-6x text-success mb-4"
            style="filter: drop-shadow(0 0 30px #00ff00)"
          ></i>
          <h1 class="fw-bold text-white mb-2">PEMBAYARAN SUKSES!</h1>
          <p class="text-secondary mb-4">
            Item Anda sedang dikirim secara otomatis.
          </p>
          <button
            onclick="window.location.href = 'index.html'"
            class="btn btn-outline-light rounded-pill px-4"
          >
            Buat Pesanan Baru
          </button>
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script src="firebase-config.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script src="invoice.js"></script>
  </body>
</html>
